<section>
    <span>Generic solver</span>
    <h2>Chord method</h2>

    <div class="content">
        <ul class="content-nav">
            <li
                    [ngClass]="{ selected: labelSelected.value }"
                    (click)="handleLabels(true)"
            >
                Information
            </li>
            <li
                    [ngClass]="{ selected: !labelSelected.value }"
                    (click)="handleLabels(false)"
            >
                Input
            </li>
        </ul>
        <div>
            @if (labelSelected.value) {
                <div class="content-section">
                    <h2>What is the Chord Method?</h2>
                    <p>
                        Picture a rope stretched between two points on a curvy hill, and you're trying to find where the hill dips to exactly sea level (zero). The rope gives you a straight line, and where it crosses sea level is a guess for the dip.
                    </p>
                    <p>
                        You check that crossing point. If it's not quite at sea level, you move one end of the rope to that point and stretch it again. Each time, the rope gets you <strong>closer</strong> to the exact dip!
                    </p>
                    <hr/>
                    <h3>How it works with math</h3>
                    <p>
                        The chord method (also called the secant method) finds where a function <strong>f(x) = 0</strong>. We start with two guesses: <strong>a</strong> and <strong>b</strong>, and:
                    </p>
                    <ul>
                        <li>Draw a "rope" (straight line) between <strong>f(a)</strong> and <strong>f(b)</strong>.</li>
                        <li>Find where this line crosses <strong>f(x) = 0</strong>. That’s our new guess, <strong>c</strong>, calculated as:</li>
                        <li><strong>c = b - f(b) * (b - a) / (f(b) - f(a))</strong></li>
                        <li>Check if <strong>f(c)</strong> is close enough to 0 (like 0.0001). If yes, we’re done!</li>
                        <li>If not, replace <strong>a</strong> with <strong>b</strong>, and <strong>b</strong> with <strong>c</strong>, then repeat.</li>
                    </ul>
                    <p>
                        This method is <strong>faster</strong> than bisection but needs good starting points and may not always converge if the function is too wild.
                    </p>
                </div>
            } @else {
                <div class="example-section">
                    <h2>Try These Example Equations</h2>
                    <p>Use <strong>x</strong> as your variable.</p>

                    <h3>Polynomial Examples</h3>
                    <ul>
                        <li><code>x^3 - 4*x + 1</code></li>
                        <li><code>x^2 - 3</code>   <em>(root: √3)</em></li>
                        <li><code>x^3 + 2*x - 5</code></li>
                        <li><code>3*x^3 - x^2 + 2</code></li>
                    </ul>

                    <h3>Functions with <code>e^x</code></h3>
                    <ul>
                        <li><code>exp(x) - 3*x</code></li>
                        <li><code>x * exp(x) - 2</code></li>
                        <li><code>exp(x) - 5</code></li>
                        <li><code>exp(2*x) - x - 1</code></li>
                    </ul>

                    <p>
                        You can copy any of these equations and paste them directly into the input field.
                        <br/>
                        <strong>Tip:</strong> Choose starting points <em>a</em> and <em>b</em> close to the root for faster convergence.
                    </p>
                </div>
            }
        </div>
    </div>

    <form [formGroup]="chordForm" (ngSubmit)="handleSave()">
        <div>
            <div>
                <label for="function">Function:</label>
                <input
                        type="text"
                        id="function"
                        name="function"
                        formControlName="equation"
                        placeholder="x^3 - 4*x + 1"
                        required
                />
            </div>
            <div>
                <label for="lowerBound">Lower Bound:</label>
                <input
                        type="number"
                        id="lowerBound"
                        name="lowerBound"
                        formControlName="lowerBound"
                        placeholder="0"
                        required
                />
                <label for="upperBound">Upper Bound:</label>
                <input
                        type="number"
                        id="upperBound"
                        name="upperBound"
                        formControlName="upperBound"
                        placeholder="1"
                        required
                />
                <label for="tolerance">Tolerance</label>
                <input
                        type="number"
                        id="tolerance"
                        name="tolerance"
                        formControlName="epsilon"
                        placeholder="0.0001"
                        required
                />
            </div>
        </div>
        <div class="buttons">
            <button type="submit">Display calculation</button>
        </div>
    </form>

    <div id="bisectionGraph"></div>

    @if (response | async; as data) {
        <div class="result">
            <h3>Result</h3>
            <p>Root: {{ data.result }}</p>
            <table>
                <tr>
                    <th>fX0</th>
                    <th>fX1</th>
                    <th>p</th>
                    <th>x0</th>
                    <th>xNext</th>
                </tr>
                @for (item of data.table; track item['p']) {
                    <tr>
                        <td>{{ item['fX0'] }}</td>
                        <td>{{ item['fX1'] }}</td>
                        <td>{{ item['p'] }}</td>
                        <td>{{ item['x0'] }}</td>
                        <td>{{ item['xNext'] }}</td>
                    </tr>
                }
            </table>
        </div>
    }

</section>